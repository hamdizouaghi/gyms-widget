
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gyms Directory</title>

<style>
  :root {
    --card-radius: 16px;
    --card-bg: #fff;
    --card-border: #e5e7eb;
    --shadow: 0 2px 12px rgba(0,0,0,0.08);
    --text-muted: #6b7280;
    --accent: #f5a623;
  1px solid #d1d5db;
    border-radius: 10px;
    background: #fff;
    font-size: 14px;
    cursor: pointer;
    min-width: 140px;
  }

  #gyms {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  .gym-card {
    background: var(--card-bg);
    border-radius: var(--card-radius);
    border: 1px solid var(--card-border);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  .gym-cover {
    width: 100%;
    height: 200px;
    object-fit: cover;
    display: block;
    background: #ddd;
  }

  .gym-info {
    padding: 14px 16px;
  }

  .gym-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 6px;
    color: #111827;
  }

  .gym-line {
    font-size: 14px;
    margin-top: 3px;
  }

  .gym-line span {
    color: var(--text-muted);
  }

  .rating-label {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 10px;
  }

  .stars {
    color: var(--accent);
    font-size: 18px;
  }

  #pager {
    margin: 20px 0;
    text-align: center;
  }

  .pager-btn {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin: 0 8px;
    background: #fff;
    cursor: pointer;
  }

  .pager-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>
</head>

<body>

<div id="filters-bar"></div>
<div id="gyms"></div>
<div id="pager"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const SHEET_URL =
    "https://opensheet.elk.sh/1-M0Olh2CNmzAkNrQAYC246cJAPkElQZcEh9aLfYbb54/Sheet1";

  const gymsContainer = document.getElementById("gyms");
  const filtersBar = document.getElementById("filters-bar");
  const pagerContainer = document.getElementById("pager");

  let gymsData = [];
  let filteredData = [];
  let currentPage = 1;
  const PAGE_SIZE = 12;

  filtersBar.innerHTML = `
    <select id="googleRating" class="filter-select">
      <option value="0">Google rating</option>
      <option value="1">★ 1+</option>
      <option value="2">★ 2+</option>
      <option value="3">★ 3+</option>
      <option value="4">★ 4+</option>
      <option value="4.5">★ 4.5+</option>
      <option value="5">★ 5</option>
    </select>

    <select id="governance" class="filter-select">
      <option value="">Governorate</option>
      <option>Ariana</option>
      <option>Béja</option>
      <option>Ben Arous</option>
      <option>Bizerte</option>
      <option>Gabès</option>
      <option>Gafsa</option>
      <option>Jendouba</option>
      <option>Kairouan</option>
      <option>Kasserine</option>
      <option>Kebili</option>
      <option>Kef</option>
      <option>Mahdia</option>
      <option>Manouba</option>
      <option>Medenine</option>
      <option>Monastir</option>
      <option>Nabeul</option>
      <option>Sfax</option>
      <option>Sidi Bouzid</option>
      <option>Siliana</option>
      <option>Sousse</option>
      <option>Tataouine</option>
      <option>Tozeur</option>
      <option>Tunis</option>
      <option>Zaghouan</option>
    </select>

    <select id="cityFilter" class="filter-select" disabled>
      <option value="">City</option>
    </select>
  `;

  const ratingSelect = document.getElementById("googleRating");
  const govSelect = document.getElementById("governance");
  const citySelect = document.getElementById("cityFilter");

  fetch(SHEET_URL)
   rateNum: parseFloat(String(row.Rate || "").replace(",", "."))
      }));

      refreshCityOptions();
      applyFilters();
    });

  function applyFilters() {
    const minRate = parseFloat(ratingSelect.value);
    const gov = govSelect.value.trim();
    const city = citySelect.value.trim();

    filteredData = gymsData.filter(g => {
      let okRate = isNaN(minRate) || minRate === 0 || g._rateNum >= minRate;
      let okGov = !gov || g.Governorate === gov;
      let okCity = !city || g.City === city;
      return okRate && okGov && okCity;
    });

    currentPage = 1;
    renderPage();
  }

  function refreshCityOptions() {
    const gov = govSelect.value.trim();
    if (!gov) {
      citySelect.disabled = true;
      citySelect.innerHTML = `<option value="">City</option>`;
      return;
    }

    const cities = [...new Set(
      gymsData.filter(g => g.Governorate === gov).map(g => g.City)
    )].sort();

    citySelect.disabled = false;
    citySelect.innerHTML =
      `<option value="">City</option>` +
      cities.map(c => `<option>${c}</option>`).join("");
  }

  ratingSelect.onchange = applyFilters;
  govSelect.onchange = () => { refreshCityOptions(); applyFilters(); };
  citySelect.onchange = applyFilters;

  function renderPage() {
    const total = filteredData.length;
    const totalPages = Math.ceil(total / PAGE_SIZE);

    const start = (currentPage - 1) * PAGE_SIZE;
    const slice = filteredData.slice(start, start + PAGE_SIZE);

    renderGyms(slice);
    renderPager(totalPages);
  }

  function renderPager(totalPages) {
    if (totalPages <= 1) {
      pagerContainer.innerHTML = "";
      return;
    }
    pagerContainer.innerHTML = `
      <button class="pager-btn" id="prev" ${currentPage===1?"disabled":""}>Previous</button>
      <button class="pager-btn" id="next" ${currentPage===totalPages?"disabled":""}>Next</button>
    `;
    document.getElementById("prev").onclick = () => { currentPage--; renderPage(); };
    document.getElementById("next").onclick = () => { currentPage++; renderPage(); };
  }

  function normalizeImage(url) {
    if (!url) return "";
    const file = url.match(/\/d\/([A-Za-z0-9_-]+)/);
    if (file) return `https://lh3.googleusercontent.com/d/${file[1]}`;
    const id = url.match(/id=([A-Za-z0-9_-]+)/);
    if (id) return `https://lh3.googleusercontent.com/d/${id[1]}`;
    return url;
  }

  function firstImage(url) {
    if (!url) return "";
    const parts = url.split(/[|\s]+/).filter(Boolean);
    return normalizeImage(parts[0]);
  }

  function stars(v) {
    if (!v) return "N/A";
    const f = Math.floor(v);
    const half = (v - f >= .5) ? 1 : 0;
    const empty = 5 - f - half;
    return "★".repeat(f) + (half ? "☆" : "") + "✩".repeat(empty);
  }

  function renderGyms(list) {
    if (!list.length) {
      gymsContainer.innerHTML = "<p>No results.</p>";
      return;
    }

    gymsContainer.innerHTML = list.map(g => `
      <div class="gym-card">
        ${firstImage(g.Image)}
        <div class="gym-info">
          <div class="gym-title">${g.Name}</div>
          <div class="gym-line">Governorate: <span>${g.Governorate}</span></div>
          <div class="gym-line">City: <span>${g.City}</span></div>
          <div class="rating-label">Google Rating</div>
          <div class="stars">${stars(g._rateNum)}</div>
        </div>
      </div>
    `).join("");
  }

});
</script>

</body>
</html>
