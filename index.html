
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gyms Directory</title>

<style>
  :root {
    --card-radius: 16px;
    --card-bg: #fff;
    --card-border: #e6e6e6;
    --shadow: 0 4px 14px rgba(0,0,0,0.08);
    --text-muted: #6b7280;
    --accent: #f5a623;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 16px;
    background: #f5f5f5;
  }

  #filters-bar {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .filter-select {
    padding: 10px 14px;
    border: 1px solidd1d5db;
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
    background: #fff;
  }

  #gyms {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  .gym-card {
    background: var(--card-bg);
    border-radius: var(--card-radius);
    border: 1px solid var(--card-border);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  .gym-cover {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: #ddd;
    display: block;
  }

  .gym-info {
    padding: 14px 16px;
  }

  .gym-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 6px;
  }

  .gym-line {
    font-size: 14px;
    margin: 4px 0;
  }

  .gym-line span {
    color: var(--text-muted);
  }

  .rating-label {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 8px;
  }

  .stars {
    font-size: 18px;
    color: var(--accent);
  }

  #pager {
    margin: 20px 0;
    text-align: center;
  }

  .pager-btn {
    padding: 8px 12px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    cursor: pointer;
    margin: 0 6px;
  }

  .pager-btn:disabled {
    opacity: 0.5;
  }
</style>
</head>

<body>

<div id="filters-bar"></div>
<div id="gyms"></div>
<div id="pager"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const SHEET_URL =
    "https://opensheet.elk.sh/1-M0Olh2CNmzAkNrQAYC246cJAPkElQZcEh9aLfYbb54/Sheet1";

  const gymsContainer = document.getElementById("gyms");
  const filtersBar = document.getElementById("filters-bar");
  const pager = document.getElementById("pager");

  let gymsData = [];
  let filteredData = [];
  let currentPage = 1;
  const PAGE_SIZE = 12;

  /* ---------------------------------- FILTER BAR ---------------------------------- */
  filtersBar.innerHTML = `
    <select id="googleRating" class="filter-select">
      <option value="0">Google rating</option>
      <option value="1">★ 1+</option>
      <option value="2">★ 2+</option>
      <option value="3">★ 3+</option>
      <option value="4">★ 4+</option>
      <option value="4.5">★ 4.5+</option>
      <option value="5">★ 5</option>
    </select>

    <select id="governorate" class="filter-select">
      <option value="">Governorate</option>
      <option>Ariana</option>
      <option>Béja</option>
      <option>Ben Arous</option>
      <option>Bizerte</option>
      <option>Gabès</option>
      <option>Gafsa</option>
      <option>Jendouba</option>
      <option>Kairouan</option>
      <option>Kasserine</option>
      <option>Kebili</option>
      <option>Kef</option>
      <option>Mahdia</option>
      <option>Manouba</option>
      <option>Medenine</option>
      <option>Monastir</option>
      <option>Nabeul</option>
      <option>Sfax</option>
      <option>Sidi Bouzid</option>
      <option>Siliana</option>
      <option>Sousse</option>
      <option>Tataouine</option>
      <option>Tozeur</option>
      <option>Tunis</option>
      <option>Zaghouan</option>
    </select>

    <select id="cityFilter" class="filter-select" disabled>
      <option value="">City</option>
    </select>
  `;

  const ratingSelect = document.getElementById("googleRating");
  const govSelect = document.getElementById("governorate");
  const citySelect = document.getElementById("cityFilter");

  /* ---------------------------------- HELPERS ---------------------------------- */

 d\/([A-Za-z0-9_-]{25,})/);
    if (m) return m[1];
    m = url.match(/id=([A-Za-z0-9_-]{25,})/);
    return m ? m[1] : "";
  }

  function driveLh3(id) {
    return `https://lh3.googleusercontent.com/d/${id}`;
  }

  function driveThumb(id) {
    return `https://drive.google.com/thumbnail?id=${id}&sz=w1600`;
  }

  function getImage(raw) {
    if (!raw) return "";
    const parts = raw.split(/[|\s]+/).filter(Boolean);
    const id = extractDriveId(parts[0]);
    if (!id) return "";

    return driveLh3(id);
  }

  function stars(rate) {
    if (!rate) return "N/A";
    let full = Math.floor(rate);
    let half = (rate - full >= 0.5) ? 1 : 0;
    let empty = 5 - full - half;
    return "★".repeat(full) + (half ? "☆" : "") + "✩".repeat(empty);
  }

  /* ---------------------------------- LOAD DATA ---------------------------------- */
  fetch(SHEET_URL)
    .then(r => r.json())
    .then(data => {
      gymsData = data.map(g => ({
        ...g,
        Image: (g.Image ?? g.image ?? "").trim(),
        _rateNum: parseFloat(String(g.Rate || "").replace(",", "."))
      }));
      updateCities();
      applyFilters();
    });

  /* ---------------------------------- FILTERS ---------------------------------- */
  function updateCities() {
    const gov = govSelect.value;

    if (!gov) {
      citySelect.disabled = true;
      citySelect.innerHTML = `<option value="">City</option>`;
      return;
    }

    const cities = [...new Set(
      gymsData
        .filter(g => g.Governorate === gov)
        .map(g => g.City)
    )].sort();

    citySelect.disabled = false;
    citySelect.innerHTML = `<option value="">City</option>` +
      cities.map(c => `<option>${c}</option>`).join("");
  }

  function applyFilters() {
    const rate = parseFloat(ratingSelect.value);
    const gov = govSelect.value;
    const city = citySelect.value;

    filteredData = gymsData.filter(g =>
      (!rate || g._rateNum >= rate) &&
      (!gov || g.Governorate === gov) &&
      (!city || g.City === city)
    );

    currentPage = 1;
    renderPage();
  }

  ratingSelect.addEventListener("change", applyFilters);
  govSelect.addEventListener("change", () => { updateCities(); applyFilters(); });
  citySelect.addEventListener("change", applyFilters);

  /* ---------------------------------- PAGINATION ---------------------------------- */
  function renderPage() {
    const start = (currentPage - 1) * PAGE_SIZE;
    const slice = filteredData.slice(start, start + PAGE_SIZE);
    renderGyms(slice);
    renderPager();
  }

  function renderPager() {
    const totalPages = Math.ceil(filteredData.length / PAGE_SIZE);

    if (totalPages <= 1) {
      pager.innerHTML = "";
      return;
    }

    pager.innerHTML = `
      <button class="pager-btn" id="prev" ${currentPage === 1 ? "disabled" : ""}>Previous</button>
      <button class="pager-btn" id="next" ${currentPage >= totalPages ? "disabled" : ""}>Next</button>
    `;

    document.getElementById("prev").onclick = () => { currentPage--; renderPage(); };
    document.getElementById("next").onclick = () => { currentPage++; renderPage(); };
  }

  /* ---------------------------------- RENDER CARDS ---------------------------------- */
  function renderGyms(list) {
    if (!list.length) {
      gymsContainer.innerHTML = "<p>No results.</p>";
      return;
    }

    gymsContainer.innerHTML = list.map(g => {
      const raw = g.Image || "";
      const id = extractDriveId(raw);
      let url = id ? driveLh3(id) : "";

      return `
        <div class="gym-card">
          <img class="gym-cover" 
               src="${url}" 
              -title">${g.Name}</div>
            <div class="gym-line">Governorate: <span>${g.Governorate}</span></div>
            <div class="gym-line">City: <span>${g.City}</span></div>
            <div class="rating-label">Google Rating</div>
            <div class="stars">${stars(g._rateNum)}</div>
          </div>
        </div>
      `;
    }).join("");
  }

});
</script>

</body>
</html>
